<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>4-8</title>
		<style>
			#canvas1{
				border:1px solid gray;
				background-image:url(bg1.png);		/*背景画像*/
			}
		</style>
	</head>

	<body>
		<canvas id="canvas1" width="400" height="400"></canvas>
		<audio src="audio1.mp3" id="audio1"></audio>

		<script>
			var canvas1 = document.getElementById("canvas1");
			var c = canvas1.getContext("2d");

			//効果音取り込み
			var audio1 = document.getElementById("audio1");

			//初期化
			var target = {x:200, y:100, w:50, h:50, dir:1, color:"orange",img:new Image()};		//★追加修正	//ターゲット
			var player = {x:200, y:300, w:50, h:50, color:"skyblue"};						//プレイヤー
			var ball = {x:-10, y:-10, w:5, h:5, color:"pink"};							//ボール
			var point = 0;																	//得点

			target.img.src="target1.png";

			//実行
			setInterval(loop, 50);

			function loop(){

				//①消去----------------------
				c.clearRect(0, 0, canvas1.width, canvas1.height);

				//②描画----------------------
				imgDraw(target);
				rectDraw(player);
				rectDraw(ball);

				//ポイント
				c.fillStyle = "black";
				c.font = "20px sans-serif ";
				c.fillText(point, 0, 400);


				//③計算---------------
				target.x += target.dir;
				ball.y -= 5;
	
				//壁衝突計算
				if((target.x < 25) || (375 < target.x)){
					target.dir *= -1;
				}
	
				//得点ゲット
				if((100 == ball.y) && (Math.abs(target.x - ball.x)<25)){
					point++; 
					audio1.play();							//音を鳴らす
				}


			}

			//矩形の定義
			function rectDraw(obj){
				c.save();
				c.translate(obj.x, obj.y);
				c.rotate(obj.angle / 180 * Math.PI);
				c.scale(obj.scaleX, obj.scaleY);

				c.fillStyle = obj.color;
				c.fillRect(0-obj.w/2, 0-obj.h/2, obj.w, obj.h);

				c.restore();
			}
			
			//画像描画の定義
			function imgDraw(obj){
				c.save();
				c.translate(obj.x, obj.y);
				c.rotate(obj.angle / 180 * Math.PI);
				c.scale(obj.scaleX, obj.scaleY);

				c.drawImage(obj.img,0-obj.w/2, 0-obj.h/2, obj.w, obj.h);

				c.restore();
			}
			
			
			
			
			
			
			//イベント処理
			canvas1.addEventListener("mousedown",function(e){
				ball.x = player.x;
				ball.y = player.y; 
			});
	
			canvas1.addEventListener("mousemove",function(e){
				var rect = e.target.getBoundingClientRect();
				player.x = e.clientX-rect.left;
			});
		</script>
	</body>
</html>